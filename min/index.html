<body bgcolor=0><center><canvas width=1280 height=648 style="border:1px solid;background:#5C94FC;cursor:pointer"oncontextmenu="return false"id=a><img src=tileset.png hidden id=tileset><script>function W(){b={c:[],a:[],i:[],b:[],u:!1};for(j=0;20>j;j++)b.c[j]=[];m=A=F=p=t=0}function P(){K=!1;r=Q=L=0;c={x:0,y:0,J:0,f:0,g:0,I:[],G:[],F:[],H:[],direction:1,state:0,h:null,m:!0,v:null,B:null,l:0};g=24;M=2;N=B=20;R=6;X=[0,0,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0];b.b=[];S=!1;e=[]}function u(c,d){return b.c[d]?!b.c[d][c]||14>b.c[d][c]||24<b.c[d][c]:0}function v(b,c){return c&&7==b||X[b]||0}function C(c,d,e){b.c[~~(d/32)]&&(b.c[~~(d/32)][~~(c/32)]=e)}function h(c,d){return b.c[~~(d/32)]?b.c[~~(d/32)][~~(c/32)]:0}function T(b,c,e){d.drawImage(tileset,16*b,0,16,16,c,e,32,32)}function f(b,c,e){d.drawImage(tileset,16*b,0,16,16,32*c,40+32*e,32,32)}function aa(){a.width^=0;d.font="bold 30px arial";d.fillStyle="#000";d.fillText("\u00d7",1255,25);d.A=!1;d.w=!1;if(0==r)for(b.c=[],j=0;20>j;j++)for(b.c[j]=[],i=0;40>i;i++)b.c[j][i]=b.hash.charCodeAt(40*j+i)-48;if(0==r)for(i in b.a)e[i]={j:!1,y:32*b.a[i][1]};for(i in b.a){e[i].j?(e[i].y>32*b.a[i][2]&&(e[i].y=Math.max(e[i].y-4,32*b.a[i][2])),e[i].y<32*b.a[i][2]&&(e[i].y=Math.min(e[i].y+4,32*b.a[i][2]))):(e[i].y>32*b.a[i][1]&&(e[i].y=Math.max(e[i].y-4,32*b.a[i][1])),e[i].y<32*b.a[i][1]&&(e[i].y=Math.min(e[i].y+4,32*b.a[i][1])));G=!1;for(k=~~(e[i].y/32)+1;21>k;k++)if(20>k&&!b.c[k][b.a[i][0]]&&!b.c[k][b.a[i][0]+1]&&!G)f(18,b.a[i][0],k),f(19,b.a[i][0]+1,k);else{G=!0;e[i].D=32*k;break}T(16,32*b.a[i][0],e[i].y+40);T(17,32*b.a[i][0]+32,e[i].y+40);b.a[i][4]&&(e[i].j?f(21,b.a[i][3],b.a[i][4]):f(20,b.a[i][3],b.a[i][4]))}for(j=0;20>j;j++)for(i=0;40>i;i++){z=b.c[j][i];12==z&&0==r&&(b.b.push({x:32*i,y:32*j,f:0,o:null}),z=0,b.c[j][i]=0);f(z,i,j);if(2==z&&(H=!1,20>j))for(k=j+1;20>k;k++)b.c[k][i]||H?H=!0:(f(24,i,k),b.c[k][i]=24);23==z&&(b.start=[i,j])}D=!1;for(j=0;20>j;j++)for(i=0;40>i;i++)25==b.c[j][i]&&(b.c[j][i]=11);for(i in b.a)e[i].j=!1;0==r&&(c.x=32*b.start[0],c.y=32*b.start[1]);if(3!=c.state&&!K){c.state=0;if(c.right){c.G[r]=!0;c.x+=R;c.direction=1;c.g&&(c.state=1);if(v(h(c.x+g,c.y))||v(h(c.x+g,c.y+31)))c.x=32*~~(c.x/32)+32-g-1;c.x>1280-g&&(c.x=1280-g,c.state=0);for(j in b.a)c.x+g>=32*b.a[j][0]&&c.x+g<=32*b.a[j][0]+16&&c.y+31>=e[j].y&&c.y<=e[j].D&&(c.x=32*b.a[j][0]-g-1)}if(c.left){c.F[r]=!0;c.x-=R;c.direction=0;c.g&&(c.state=1);if(v(h(c.x,c.y))||v(h(c.x,c.y+31)))c.x=32*~~(c.x/32)+32;0>c.x&&(c.x=0,c.state=0);for(j in b.a)c.x>=32*b.a[j][0]+64-16&&c.x<=32*b.a[j][0]+64&&c.y+31>=e[j].y&&c.y<=e[j].D&&(c.x=32*b.a[j][0]+64)}c.g=!1;c.f+=M;c.f>B&&(c.f=B);c.y+=c.f;11==h(c.x,c.y+20)?(C(c.x,c.y+20,25),D=!0):11==h(c.x+g,c.y+20)&&(C(c.x+g,c.y+20,25),D=!0);for(i in b.a)c.x+g>=32*b.a[i][3]&&c.x<=32*b.a[i][3]+32&&c.y+32>=32*b.a[i][4]&&c.y+20<=32*b.a[i][4]+32&&(e[i].j=!0);if(0<c.f){if(v(h(c.x,c.y+32))||v(h(c.x+g,c.y+32)))c.y=32*~~(c.y/32),c.f=0,c.g=!0;for(i in b.b)c.x+g>b.b[i].x&&c.x<b.b[i].x+31&&c.y+31>b.b[i].y&&c.y+31<b.b[i].y+20&&(c.y=b.b[i].y-32,c.f=0,c.g=!0,c.v=i,c.B=c.x-b.b[i].x);for(j in b.a)console.log(c.y,e[j].y),c.x+g>=32*b.a[j][0]&&c.x<32*b.a[j][0]+64&&c.y+31>=e[j].y&&c.y+31<=e[j].y+32&&(c.y=e[j].y-32,c.f=0,c.g=!0)}c.C&&c.g&&c.m&&(c.I[r]=!0,c.f-=N,c.g=!1,c.m=!1);if(v(h(c.x,c.y))||v(h(c.x+g,c.y)))5==h(c.x,c.y)&&C(c.x,c.y,0),5==h(c.x+g,c.y)&&C(c.x+g,c.y,0),c.y=32*~~(c.y/32)+32,c.f=0;0>c.f&&!c.g&&(c.state=2);6==h(c.x+g/2,c.y+16)&&C(c.x+g/2,c.y+16,0);if(7==h(c.x+3,c.y)||7==h(c.x+g-3,c.y)||7==h(c.x+3,c.y+5)||7==h(c.x+g-3,c.y+5))c.state=3,c.f=-1.5*N;648<c.y&&(c.state=3,c.f=-1.5*N);if(c.s){if(c.H[r]=!0,null===c.h)for(i in b.b)if(c.x+g>=b.b[i].x&&c.x<=b.b[i].x+31&&c.y+31>=b.b[i].y&&c.y<=b.b[i].y+31){c.h=i;b.b[i].o=c;c.l=5;break}}else b.b[c.h]&&(b.b[c.h].o=null,c.h=null);null!==c.h?(b.b[c.h].x=c.x+-8*c.direction,c.l&&c.l--,b.b[c.h].y=c.y-32+4*c.l):c.s=0;if(2==h(c.x+g/2,c.y+16)||24==h(c.x+g/2,c.y+16)){for(j=L=0;20>j;j++)for(i=0;40>i;i++)6==b.c[j][i]&&L++;0==L&&(K=!0)}}3==c.state&&(c.f+=M,c.f>B&&(c.f=B),c.y+=c.f);for(i in b.b){11==h(b.b[i].x,b.b[i].y+20)?(C(b.b[i].x,b.b[i].y+20,25),D=!0):11==h(b.b[i].x+32,b.b[i].y+20)&&(C(b.b[i].x+32,b.b[i].y+20,25),D=!0);for(j in b.a)b.b[i].x+32>=32*b.a[j][3]&&b.b[i].x<=32*b.a[j][3]+32&&b.b[i].y+32>=32*b.a[j][4]&&b.b[i].y+20<=32*b.a[j][4]+32&&(e[j].j=!0);if(null===b.b[i].o){b.b[i].f+=M;b.b[i].f>B&&(b.b[i].f=B);b.b[i].y+=b.b[i].f;if(v(h(b.b[i].x,b.b[i].y+32),1)||v(h(b.b[i].x+32,b.b[i].y+32),1))b.b[i].y=32*~~(b.b[i].y/32),b.b[i].f=0;for(j in b.b)j!=i&&b.b[i].x+32>=b.b[j].x&&b.b[i].x<=b.b[j].x+31&&b.b[i].y+31>=b.b[j].y&&b.b[i].y+31<=b.b[j].y+20&&(b.b[i].y=b.b[j].y-32,b.b[i].f=0,b.b[i].g=!0,b.b[i].v=j,b.b[i].B=b.b[i].x-b.b[j].x);for(j in b.a)b.b[i].x+32>=32*b.a[j][0]&&b.b[i].x<32*b.a[j][0]+64&&b.b[i].y+31>=e[j].y&&b.b[i].y+31<=e[j].y+32&&(b.b[i].y=e[j].y-32,b.b[i].f=0,b.b[i].g=!0)}}for(i in b.b)d.drawImage(tileset,192,0,16,16,b.b[i].x,40+b.b[i].y,32,32);1==c.direction?d.drawImage(tileset,16*[26,[27,28,29][~~(r/2)%3],30,31][c.state],0,16,16,c.x-4,40+c.y,32,32):(d.save(),d.translate(c.x+g+4,c.y),d.scale(-1,1),d.drawImage(tileset,16*[26,[27,28,29][~~(r/2)%3],30,31][c.state],0,16,16,0,40,32,32),d.restore());if(D!=S)for(j=0;20>j;j++)for(i=0;40>i;i++)9==b.c[j][i]?b.c[j][i]=10:10==b.c[j][i]&&(b.c[j][i]=9);S=D;1==Y&&1==I&&(d.font="bold 30px arial",d.fillStyle="black",d.textAlign="center",d.fillText("Move with arrow keys or WASD or ZQSD.",640,80),d.fillText("Pick and drop cubes with [space]. Restart with R.",640,120),d.fillText("Collect all coins and reach the flag.",640,160));r++;K&&(Q++,d.font="bold 100px arial",d.fillStyle="#000",d.textAlign="center",d.fillText("CLEARED!",640,350));30<=Q&&(a.width^=0,clearInterval(J),l=I,b.u=!0,a.width^=0,q())}var d=a.getContext("2d"),l=1,I=0,U=!1,V=!1,w=n=0,Y=0,b={},t,p,F,A,m,n,Z,O,G,H,E,z,K,Q,L,J,r,c,g,M,B,N,R,X,D,S,e,ba=[{},{tiles:[],pipes:[],balances:[],b:[],hash:"0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000006060600000000000000600000000000000G0000050505000000000000000000000000400033300000000000040004000000000000000040003333000000000044000440000000000000004000333330<0000004440004440000700<0<0<00400033333333333333330003333333333333333333333333333333333333000333333333333333333333"},{tiles:[],pipes:[[17,16,4,15,16]],balances:[[30,10,35,17]],b:[],hash:"000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333330000000000000000000000000000000000000000000000000000000000000<0000000000000000000000000000000000000000000000000000000000000000000000002000009999000000000000000000000000000000000000:::90000000000000000000000000000000000009999000000000000000000000000000000000000:::900000000000000000000000000000000000099990000000000000000000000000000000000000009000000000000000000000000000000300000000900000000000<00000000000000000030F000000900000000000000000000???000000030G0;0000000000000000000000000000000000033333333333333333333333000000000000???00333333333333333333333330000000000000000030000000000000000000000000000000000000000"}],q=onload=onhashchange=function(){a.width^=0;d.font="bold 30px arial";d.textAlign="center";localStorage.scpm_level|=2;location.hash&&(leveldata=location.hash.slice(1),l=2,q());0==l&&(d.A=!1,d.w=!1,d.drawImage(tileset,512,0,70,16,120,150,280,64),d.drawImage(tileset,583,0,270,16,120,250,1080,64),d.fillStyle="#000",d.beginPath(),d.fillRect(500,400,100,80),d.fillRect(650,400,100,80),d.fillStyle="#fff",d.fillText("MAKE",700,450),d.fillText("PLAY",550,450),d.stroke(),d.closePath());if(1==l){d.beginPath();d.fillStyle="#000";d.fillRect(590,520,100,80);for(i=0;10>i;i++)for(j=0;3>j;j++)E=10*j+i+1,d.fillStyle="#000",d.fillRect(120*i+50,100*j+120,100,80),d.fillStyle="#fff",d.fillText(+localStorage.scpm_level>=E?E:"?",120*i+100,100*j+170);d.fillText("LEVELS",640,70);d.fillText("MORE LEVELS ONLINE",640,470);d.fillText("GO",640,570);d.fillText("\u25c0",40,70);d.stroke();d.closePath()}2==l&&(J&&clearInterval(J),J=setInterval(aa,33));if(3==l){d.A=!1;d.w=!1;d.strokeStyle="#777";d.lineWidth=1;d.fillStyle="#fff";d.fillRect(0,0,1280,648);d.fillStyle="#5C94FC";d.fillRect(0,40,1280,640);d.beginPath();for(i=0;16>i;i++)d.fillRect(8+35*i,3,32,32),d.rect(8+35*i,3,32,32),T(i,8+35*i,3);for(j=0;j<b.c.length;j++)for(i=0;i<b.c[j].length;i++)if(z=b.c[j][i],f(z,i,j),2==z&&(H=!1,20>j))for(k=j+1;20>k;k++)b.c[k][i]||H?H=!0:f(24,i,k);for(i in b.a){O=b.a[i][1];if(b.a[i][2])for(Z=b.a[i][1]<b.a[i][2]?b.a[i][1]:b.a[i][2],O=b.a[i][1]<b.a[i][2]?b.a[i][2]:b.a[i][1],k=Z+1;k<O;k++)f(18,b.a[i][0],k),f(19,b.a[i][0]+1,k),b.c[k][b.a[i][0]]=18,b.c[k][b.a[i][0]+1]=19;if(b.a[i][1])for(G=!1,k=O+1;21>k;k++)20>k&&!b.c[k][b.a[i][0]]&&!b.c[k][b.a[i][0]+1]&&!G?(f(18,b.a[i][0],k),f(19,b.a[i][0]+1,k)):G=!0;b.a[i][1]&&(f(16,b.a[i][0],b.a[i][1]),f(17,b.a[i][0]+1,b.a[i][1]));b.a[i][2]&&(f(16,b.a[i][0],b.a[i][2]),f(17,b.a[i][0]+1,b.a[i][2]));b.a[i][4]&&f(20,b.a[i][3],b.a[i][4])}0<=n&&!V&&(1==m?0<n&&(f(22,w,n-1),f(23,w,n)):14==m?(0==t&&(f(16,w,n),f(17,w+1,n)),1==t&&(f(16,b.a[p][0],n),f(17,b.a[p][0]+1,n)),2==t&&f(20,w,n)):15==m?(f(15,w-1,n),f(15,w,n),f(15,w+1,n)):f(m,w,n));for(i=0;40>i;i++)d.moveTo(32*i,40),d.lineTo(32*i,648);for(j=0;20>j;j++)d.moveTo(0,40+32*j),d.lineTo(1280,40+32*j);d.fillStyle="#000";d.fillRect(750,4,100,32);d.fillRect(875,4,100,32);d.fillRect(1E3,4,100,32);d.fillRect(1125,4,100,32);d.fillStyle="#fff";d.font="bold 20px arial";d.fillText("TEST",800,28);d.fillText("SHARE",925,28);d.fillText("CLEAR",1050,28);d.fillText("EXIT",1175,28);d.stroke();d.closePath();d.beginPath();i=m;d.strokeStyle="red";d.lineWidth=3;d.rect(8+35*i,3.5,32,32);d.stroke();d.closePath()}};onclick=function(c){x=c.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft;y=c.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop;0==l&&(d.beginPath(),d.rect(500,400,100,80),d.isPointInPath(x,y)&&(l=1,q()),d.closePath(),d.beginPath(),d.rect(650,400,100,80),d.isPointInPath(x,y)&&(l=3,W(),q()),d.closePath());if(1==l)for(d.beginPath(),d.rect(30,30,50,50),d.isPointInPath(x,y)&&(l=0,q()),d.closePath(),d.beginPath(),d.rect(590,520,100,80),d.isPointInPath(x,y)&&(location="todo"),d.closePath(),i=0;10>i;i++)for(j=0;3>j;j++)E=10*j+i+1,+localStorage.scpm_level>=E&&(d.beginPath(),d.rect(120*i+50,100*j+120,100,80),d.isPointInPath(x,y)&&(I=1,l=2,Y=E,P(),b=ba[E],q()),d.closePath());2==l&&(d.rect(1240,0,32,32),d.isPointInPath(x,y)&&(clearInterval(J),l=I,q()),d.closePath());if(3==l){d.beginPath();d.rect(750,4,100,32);if(d.isPointInPath(x,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.c[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);P();I=3;l=2;q()}d.closePath();d.beginPath();d.rect(875,4,100,32);if(d.isPointInPath(x,y)){b.hash="";for(j=0;20>j;j++)for(i=0;40>i;i++)tile=b.c[j][i]||0,tile=16>tile||21<tile?tile:0,b.hash+=String.fromCharCode(tile+48);0==b.u&&alert("You need to test and win your level first.");prompt("Here's your level:",b.hash)}d.closePath();d.beginPath();d.rect(1E3,4,100,32);d.isPointInPath(x,y)&&(W(),q());d.closePath();d.beginPath();d.rect(1125,4,100,32);d.isPointInPath(x,y)&&(l=0,q());d.closePath();for(i=0;16>i;i++)d.beginPath(),d.rect(8.5+35*i,3.5,32,32),d.isPointInPath(x,y)&&0==t&&0==F&&(m=i,14==m&&(b.a[p]=[]),15==m&&(b.i[A]=[]),q()),d.closePath();d.beginPath();d.rect(8.5,40.5,1264,592);if(d.isPointInPath(x,y)){b.u=!1;tile_x=Math.floor(x/32);tile_y=Math.floor((y-40)/32);if(1==V)u(tile_x,tile_y)&&(b.c[tile_y][tile_x]=0);else if(1==m){if(0<tile_y&&u(tile_x,tile_y)&&u(tile_x,tile_y-1)){for(j in b.c)for(i in b.c[j])if(22==b.c[j][i]||23==b.c[j][i])b.c[j][i]=0;b.c[tile_y-1][tile_x]=22;b.c[tile_y][tile_x]=23}}else if(2==m){if(u(tile_x,tile_y)){for(j in b.c)for(i in b.c[j])2==b.c[j][i]&&(b.c[j][i]=0);b.c[tile_y][tile_x]=2}}else 14==m?u(tile_x,tile_y)&&u(tile_x+1,tile_y)&&(0==t?(b.a[p]=[],b.a[p][0]=tile_x,b.a[p][1]=tile_y,b.c[tile_y][tile_x]=16,b.c[tile_y][tile_x+1]=17,t++):1==t?(b.a[p][2]=tile_y,b.c[tile_y][b.a[p][0]]=16,b.c[tile_y][b.a[p][0]+1]=17,t++):2==t&&(b.a[p][3]=tile_x,b.a[p][4]=tile_y,b.c[tile_y][tile_x]=20,p++,t=0)):15==m?u(tile_x-1,tile_y)&&u(tile_x,tile_y)&&u(tile_x+1,tile_y)&&(0==F?(b.i[A]=[],b.i[A][0]=tile_x,b.i[A][1]=tile_y,F++):1==F&&(b.i[A][2]=tile_x,b.i[A][3]=tile_y,A++,F=0),b.c[tile_y][tile_x-1]=15,b.c[tile_y][tile_x]=15,b.c[tile_y][tile_x+1]=15):u(tile_x,tile_y)&&(b.c[tile_y][tile_x]=m);q()}d.closePath()}};onmousedown=function(b){U=!0;V=3==b.which?!0:!1};onmouseup=function(){U=!1};onmousemove=function(b){3==l&&(U&&14!=m&&15!=m&&onclick(b),x=b.pageX-a.getBoundingClientRect().left-document.documentElement.scrollLeft-document.body.scrollLeft,y=b.pageY-a.getBoundingClientRect().top-document.documentElement.scrollTop-document.body.scrollTop,w=Math.floor(x/32),n=Math.floor((y-40)/32),q())};onkeydown=onkeypress=function(b){if(2==l){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.C=!0;if(39==b.keyCode||68==b.keyCode)c.right=!0;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!0}};onkeyup=function(b){if(2==l){if(38==b.keyCode||90==b.keyCode||87==b.keyCode)c.C=!1,c.m=!0;if(39==b.keyCode||68==b.keyCode)c.right=!1;if(37==b.keyCode||65==b.keyCode||81==b.keyCode)c.left=!1;82==b.keyCode&&P();32==b.keyCode&&(c.s^=1)}}</script>